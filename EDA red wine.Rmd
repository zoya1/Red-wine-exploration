---
title: "Exploring commonly found chemicals in Red Wine By Jaya Sharma "
author: "Jaya Sharma"
date: "September 18, 2017"
output: 
  html_document: 
    fig_height: 3
    fig_width: 4
---



```{r setup, include=FALSE}
library(ggplot2)# For plots
library(gridExtra)#To arrange plots e.g grid.arrange 
library(dplyr) # To group data
library(scales) # For scaling axis log10_trans 
library(memisc) 
library (knitr) # To convert Rmd to html
library (rmarkdown)
library(corrplot)
opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# Introduction
"wineQualityReds.csv" dataset contained 1599 observations and 12 variables. There is 'X' variable whose attribute is unknown. 12 variables described various properties of wines. Three wine experts rated wines between 3(worst) and 8(best). Data exploration was done through univariate analysis and multivariate analysis to understand  data structure and distribution.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
getwd()
setwd('/Users/jayasharma/Downloads')
wine <- read.csv("wineQualityReds.csv")
head(wine)
names(wine)


```

#  Univariate Plots Section
First variables were analysed using univariate analysis plots to get feel of overall data distribution. This will help in making statistical assumptions in next steps. Univariate data analysis is a very useful way to check the quality and distribution of data and also to check for outliers. 

```{r, echo=FALSE, warning=FALSE, message=FALSE}

str(wine)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
summary(wine)
```






```{r, echo=FALSE, warning=FALSE, message=FALSE}
names(wine)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
#univariate plots
p1 <- qplot( wine$fixed.acidity, xlab = 'Fixed Acidity', binwidth = .10)
p2 <- qplot( wine$volatile.acidity, xlab = 'Volatile Acidity', binwidth = .01)
p3 <- qplot( wine$citric.acid, xlab = 'Citric Acid', binwidth = .01)
p4 <- qplot( wine$residual.sugar, xlab = 'Residual Sugar', binwidth = .1)
p5 <- qplot( wine$chlorides, xlab = 'Chlorides', binwidth = .003)
p6 <- qplot( wine$free.sulfur.dioxide, xlab = 'Free Sulfurdioxide', binwidth = 1)
p7 <- qplot( wine$total.sulfur.dioxide, xlab = 'Total Sulfurdioxide', binwidth = 1)
p8 <- qplot( wine$density, xlab = 'Density', binwidth = .001)
p9 <- qplot( wine$pH, xlab = 'pH', binwidth = .01)
p10 <- qplot( wine$sulphates, xlab = 'Sulphates', binwidth = .01)
p11 <- qplot( wine$alcohol, xlab = 'Alcohol', binwidth = .1)
p12 <- qplot( wine$quality, xlab = 'Quality', binwidth = .5)

grid.arrange(p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12, ncol = 3)

```


On ploting the variables, we observed
  - density and pH plots were normally distributed with very few outliers.
  - Fixed Acidity, volatile Acidity,  Citric Acid, Free Sulfur Dioxide, Total Sulfur Dioxide, Sulphates     plots were positively skewed 
  - Residual Sugar and Chlorides had long tailed distribution with many outliers
  -Quality was an integer, so  there was not much detail in the plot. Most wines were rated 5 or 6.         Quality was fairly normally distributed.
 


```{r, echo=FALSE, warning=FALSE, message=FALSE}
#transforming to log scales of posotively skewed plots
q1 <- ggplot(data = wine, aes( x = fixed.acidity)) + geom_histogram(binwidth = 0.05) + scale_x_log10()
q2 <- ggplot(data = wine, aes( x = volatile.acidity)) + geom_histogram(binwidth = 0.05) + scale_x_log10()
q3 <- ggplot(data = wine, aes( x = citric.acid)) + geom_histogram(binwidth = 0.05) + scale_x_log10()
q4 <- ggplot(data = wine, aes( x = free.sulfur.dioxide)) + geom_histogram(binwidth = 0.05) + scale_x_log10()
q5 <- ggplot(data = wine, aes( x = total.sulfur.dioxide)) + geom_histogram(binwidth = 0.05) + scale_x_log10()
q6 <- ggplot(data = wine, aes( x = sulphates)) + geom_histogram(binwidth = 0.05) + scale_x_log10()

grid.arrange(q1,q2,q3,q4,q5,q6, ncol = 2)

```

We plotted Fixed Acidity, Volatile Acidity, Citric Acid, Free sulfur dioxide, Total sulfur dioxide and sulfates in log10 scale.

 -The log10 plot did not reveal any new patterns for Fixed Acidity and Volatile Acidity, but it did normalize the distribution. 
 -log10 plot for Citric Acid still showed long tail distribution but on the left side in contrast to before where it was positively skewed.
 -Free sulfur dioxide and Total sulfur dioxide had positively skewed long tail distribution in the regular plot. On transforming to log10 scale both of them showed significant reduction in the  number of outliers and distribution looked fairly normally distributed.
 -Sulphates had long tailed distribution in normal graph. With the log transformation it too looked fairly normal.
 
 
 
 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
wine$total.acidity <- wine$fixed.acidity + wine$volatile.acidity + wine$citric.acid

qplot( wine$total.acidity, xlab = 'Total Acidity', binwidth = .10)



```





```{r, echo=FALSE, warning=FALSE, message=FALSE}

grid.arrange ((ggplot(wine, aes(residual.sugar)) +
  geom_histogram(binwidth = 0.1) +
  xlim(0, quantile(wine$residual.sugar, 0.95)) +
  xlab("residual.sugar (Bottom 95%)")), 
  (ggplot(wine, aes(chlorides)) +
  geom_histogram(binwidth = 0.003) +
  xlim(0, quantile(wine$chlorides, 0.95)) +
  xlab("chlorides (Bottom 95%)")), ncol = 2)


```
```


 Since Residual Sugar and Chlorides showed significantly largre number of outliers, we removed top 5% of the data and resultig plot looked fairly normal.
 
 
 
 Univariate Analysis
What is the structure of your dataset?

Red wine dataset consists of 1,599 observations of 12 variables which describe different chemical prperties of wine. 11 variables have numeric values whereas one variable, Quality, is an integer. Many people in the population enjoy wine without knowing the chemistry behind wine's quality and taste. Its very interesting to know how overall quality of wine relates to the amount of various chemical compounds that are normally present in wine.

What is/are the main feature(s) of interest in your dataset?
  To me understanding how  quality of wine correlates with the chemical content will be very exciting.
  
What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
 Several of the variables are interrelated (e.g. Fixed Acidity, Volatile Acidity, Citric Acid, pH) in this dataset  and concentration of one chemical can have effect on the other.  So I think these chemical constituents will have dominant effect in wine quality.


Did you create any new variables from existing variables in the dataset?
I created a new variable Total acidity (Fixed Acidity + Volatile Acidity + Citric Acid), which is the sum of  three variables fixed.acidity, citric acid and volatile.acidity. 

Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

 Log transformation means taking a data set and taking the natural logarithm of variables. Sometimes when data does not quite fit the model we are looking for, a log transformation can help to fit a very skewed distribution into a more normal model (a “bell curve“). Such that, we can more easily see patterns in our data. Log transformation itself does not “normalize” our data but it can reduce skew.
 We should only use a log transformation if:
Our data is highly skewed to the right (i.e. in the positive direction).

Some of the variables for e.g; Total Sulfur dioxide, Free Sulfur dioxide, Citric Acid, Volatile Acidity, Fixed Acidity  had a positively skewed distribution. These plots after log10transformation,  looked fairly normal. However Citric Acid which had positive skew on the regular graph, on log10 transformation it got shifted to the negative side. Not quite sure what this implies to.

There were a few variables with large number of outliers ( residual sugar, chlorides). When Top 5 percent of data was removed, fairly normal graph was obtained.

Dataset contained 82% wines rated 5 or 6 and very less data for the wines with other ratings. So it makes harder to do analysis and comparison between good wines and bad wines.  

##Bivariate plots section
Bivariant correlation matrix was created to see if there is any strong relationships among variables.

```{r echo=FALSE, warning=FALSE, message=FALSE}

head(round(wine, 2))
corrplot(cor(wine), method = "number")

```



Since the focus of this data exploration was to find chemical parameters affecting wine quality, we were unable to see  strong relationships  between quality and other variables in bivariate correlation matrix plot. This plot showed - variables with positive correlations (r value > 0.45) were quality and alcohol, total acidity and density. Variables with negative correlations were alcohol and density, total acidity and pH. These correlations were further studied in our bivariate analysis.
Variables with large number of outliers could be a reason that we did not see strong relationship between quality and chemical parameters. Besides, quality being a rating variable with integer values and with maximum number of wines confined to the score of 5 or 6, could explain the lack of strong correlation between quality and other variables.

```{r, echo=FALSE, warning=FALSE, message=FALSE}

a1 <- ggplot(aes(y=alcohol,x =quality),
       data = wine)+
  geom_line(stat='summary',fun.y=median)+
  ggtitle('Alcohol content and quality perceived')

#density and quality
a2 <- ggplot(aes(y=density,x =quality),
       data = wine) +
  geom_line(stat='summary',fun.y=median)+
  ggtitle('Density of wine and Quality')

#acidity and quality
a3 <- ggplot(aes(y= pH,x =quality),
       data = wine) +
  geom_line(stat='summary',fun.y=median)+
  ggtitle('pH and Quality')

#total sulfur dioxide and quality
a4 <- ggplot(aes(y= total.sulfur.dioxide,x =quality),
       data = wine) +
  geom_line(stat='summary',fun.y=median)+
  ggtitle('Total sulfurdioxide and Quality')

#free sulfur dioxide and quality
a5 <- ggplot(aes(y= free.sulfur.dioxide,x =quality),
       data = wine) +
  geom_line(stat='summary',fun.y=median)+
  ggtitle('Free sulfurdioxide and Quality')

#residual sugar and quality
a6 <- ggplot(aes(y= residual.sugar, x = quality),
       data = wine) +
  geom_line(stat='summary', fun.y = median)+
  ggtitle('Residual sugar and Quality')

grid.arrange(a1, a2)
grid.arrange(a3, a4)
grid.arrange(a5, a6)



```
hhghghghjhgh


```{r echo=FALSE, warning=FALSE, message=FALSE}

b1 <- boxplot(pH~quality, data = wine, main = 'pH and quality', ylab = 'pH', xlab = 'Quality ratings')
b2 <- boxplot(alcohol~quality, data = wine, main = 'Alcohol (%/volume) and quality', ylab = 'Alcohol', xlab = 'Quality ratings')
b3 <- boxplot(density~quality, data = wine, main = 'Density ((g / cm^3)) and quality', ylab = 'Density', xlab = 'Quality ratings')


```

Boxplot shows relationships between quality ratings and variables.

```{r echo=FALSE, warning=FALSE, message=FALSE}
ggplot(aes(x = quality, y = alcohol), data = wine) + 
  geom_point(alpha=1/4, position = 'jitter')+
  ggtitle('Alcohol and  Quality Relationship')
```


Bivariate Analysis
Talk about some of the relationships you observed in this part of the
investigation. How did the feature(s) of interest vary with other features in
the dataset?
According to the correlation matrix, graphs and boxplots, three parameters showing highest correlations with quality were: density, alcohol, and pH/acidity. These plots revealed wines containing higher alcohol content (%/vol) were rated high in terms of quality. Furthermore,  density and quality ratings of wines were found to be inversely proportional. This suggested lower the wine density, higher was the wine rating. Thirdly the pH of red wine varied between pH 2.8 and 4.0. Highly rated wines were in the more acidic side of the graph.


Did you observe any interesting relationships between the other features
(not the main feature(s) of interest)?

Other relationship observed was among variables describing  acidity and pH. As fixed acidity, volatile acidity, citric acid, total acidity and pH all variables describe the acidic property of wine, these five variables showed association among themselves (for eg. fixed acidity and pH, volatile acidity and pH, citric acid and pH, total acidity and pH etc). Since their association with the quality variable was not very strong as shown by matrix graph, this association was not studied further.

What was the strongest relationship you found?
The strongest association involving quality variable (variable of interest) was between quality and alcohol content(r-squared value 0.48). Strongest association between any two variables was total acidity and citric acid (r-squared value 0.69).


### Multivariate plots section

```{r echo=FALSE, warning=FALSE, message=FALSE}

ggplot(wine, aes(x = quality, y = alcohol, color = pH)) + geom_jitter(alpha = 1/2) +
  scale_color_gradient(high = 'red', low = 'yellow') +
  ggtitle('Alcohol and  Quality Relationship')

```

In the above plot, as the alcohol content of wine is increased the quality ratings of wine was also increased. Moreover, Wine with the lower pH were rated high.

```{r echo=FALSE, warning=FALSE, message=FALSE}

ggplot(aes(x = alcohol, y = pH, color = factor(quality)), data = wine) + 
  geom_jitter() +
  scale_color_brewer(type = 'div') +
  ggtitle('Alcohol and  pH Relationship')

```

Alcohol and pH relationship as shown in the above plot implies higher alcohol content with low pH make quality wines.

```{r echo=FALSE, warning=FALSE, message=FALSE}
ggplot(aes(x = alcohol, y = density, color = factor(quality)), data = wine) + 
  geom_jitter() +
  scale_color_brewer(type = 'div') +
  ggtitle('Alcohol and  Density Relationship')
  
```

Wines having higher %/volume alcohol content and low density are high quality wines.

```{r echo=FALSE, warning=FALSE, message=FALSE}
 grid.arrange(ggplot(aes(x = pH, y = fixed.acidity, color = factor(quality)), data = wine) + 
  geom_jitter() +
  scale_color_brewer(type = 'div') +
  ggtitle('pH and  Fixed Acidity Relationship'),
  
  ggplot(aes(x = pH, y = volatile.acidity, color = factor(quality)), data = wine) + 
  geom_jitter() +
  scale_color_brewer(type = 'div') +
  ggtitle('pH and Volatile Acidity Relationship'))
  
```

Above two plots show well understood and inverse relationship between acidity and pH.  In the pH and fixed acidity plot  no spcific pattern was observed. In the plot depicting volatile acidity and pH relationship, we saw that high quality wines have pH between 3 and 3.5 and contain less volatile acidity.

```{r echo=FALSE, warning=FALSE, message=FALSE}
 ggplot(aes(x = citric.acid, y = fixed.acidity, color = factor(quality)), data = wine) + 
  geom_jitter() +
  scale_color_brewer(type = 'div') +
  ggtitle('Citric Acid and Fixed Acidity Relationship')
  
```

Above plot show positive association between  citric acid and fixed acidity. 

```{r echo=FALSE, warning=FALSE, message=FALSE}

# Building the linear model for quality
m1 <- lm(quality ~ alcohol, data = wine)
m2 <- update(m1, ~ . + density)
m3 <- update(m2, ~ . + volatile.acidity)
m4 <- update(m3, ~ . + fixed.acidity)
m5 <- update(m4, ~ . + citric.acid)
mtable(m1, m2, m3, m4, m5)
par(mfrow = c(2, 2))


```

After analysing the relationship of variables with univariate analysis, bivariante analysis and multivariate analysis, we built a syntax for linear model. We can use linear model to predict the quality value if a corresponding alcohol or other values are known. Before using this regression model, model was examined for its statistic significance. p values of the linear model and predictor variables (alcohol, fixed acidity, volatile acidity and citric acid) were less than 0.05.


### Multivariate analysis

Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
Fixed acidity and citric acid showed one of the strongest positive association as per bivariate matrix plot. In the above plot of citric acid and fixed acidity with the points colored by wine quality category, we saw high quality wines confined towards one side of the plot. 

Were there any interesting or surprising interactions between features?

To me surprising interaction was no interaction between quality and residual sugar variables. Residual sugar and chlorides are very important parameters in the quality of wine however in our study we found very weak association.


OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

I created a linear model using variables alcohol, density, volatile acidity, fixed acidity and citric acid as the predictor variables and wine quality as the outcome variable. The overall r-squared value for the model was quite low 0.324. However the  model was statistically significant for variables alcohol, fixed acidity, volatile acidity and citric acid.  The summary showed p-Values were less than 0.05, pre-determined statistical significance level.

 The most important predictor variable in the model is alcohol. The limitation of this model would be the lack of diversity in the dataset for quality variable.
 
### Final Plots and Summary

## Plot One

```{r echo=FALSE, warning=FALSE, message=FALSE}

corrplot(cor(wine), method = "number")

```

For the first plot I chose the corrplot which gave both the big picture of association between variables and also the details of correlation values. Color function made distinction between positive and negative correlation.

## Plot Two

```{r echo=FALSE, warning=FALSE, message=FALSE}

```

Of all the chemical parameters, alcohol had the strongest association with the quality rating of the wine (rsquare 0.476). Wines with  higher alcohol percentage by volume were more likely to get  higher quality ratings.




important observations
-If we remove 5 % of outliers and take account of 95% of data we see residual sugar content of  wines fall between 1.5 to 3 gms/l.
-we found  another long tail distribution for alcohol percentage by volume. Most of the wines contain about 9.5% alc. The median value being 10.2% and the average, 10.42%.
-Very strange looking distribution of citric acid content among wines. Majority of wines contained 0g/L of citric acid.

In this study, I will be analysing other variables with reference to quality. In simple terms, wine is composed of different chemicals these chemicals give smells and tasete to the wine.







 
# Methods

# Results

##  subsection
##  subsection

# Conclusions and Discussion

\newpage

# References
https://www.practicalwinery.com/janfeb09/page2.htm
https://en.wikipedia.org/wiki/Acids_in_wine
http://www.statisticshowto.com/probability-and-statistics/skewed-distribution/
